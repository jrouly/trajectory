#!/bin/bash

# Halt on error.
set -e


# Make sure we're in the right folder.
if ! [ -e bin/setup ] ; then
    echo "Error: setup should be run from the project folder."
    echo "Run as: bin/setup"
    exit 1
fi


# Create basic project output directories.
mkdir -p data logs


# Install python requirements.
pyreq () {
  if [ -f "requirements.txt" ] ; then
    pip install -r requirements.txt
  else
    echo "Python requirements file not found."
    exit 1
  fi
}


# Attempt to create virtual environment & install requirements.
if [ ! -d "env" ] ; then
  virtualenv env
  source env/bin/activate
  pyreq
else
  echo "Python environment directory already exists."
  echo "Attempting to install requirements anyway."
  source env/bin/activate
  pyreq
fi


# Compile java requirements.
mvn compile


# Set environment variable and notify user.
export TRJ_HOME=$( pwd )
echo "Place this in your ~/.bashrc file:"
echo "export TRJ_HOME=$( pwd )"


exit 0
